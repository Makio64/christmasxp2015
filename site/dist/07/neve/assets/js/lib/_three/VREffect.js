THREE.VREffect=function(e,t){function n(e){for(var n=0;n<e.length;n++)if(e[n]instanceof HMDVRDevice){if(s=e[n],void 0!==s.getEyeParameters){var r=s.getEyeParameters("left"),a=s.getEyeParameters("right");o=r.eyeTranslation,c=a.eyeTranslation,l=r.recommendedFieldOfView,d=a.recommendedFieldOfView}else o=s.getEyeTranslation("left"),c=s.getEyeTranslation("right"),l=s.getRecommendedEyeFieldOfView("left"),d=s.getRecommendedEyeFieldOfView("right");break}void 0===s&&t&&t("HMD not available")}function r(e){var t=2/(e.leftTan+e.rightTan),n=(e.leftTan-e.rightTan)*t*.5,r=2/(e.upTan+e.downTan),a=(e.upTan-e.downTan)*r*.5;return{scale:[t,r],offset:[n,a]}}function a(e,t,n,a){t=void 0===t?!0:t,n=void 0===n?.01:n,a=void 0===a?1e4:a;var i=t?-1:1,s=new THREE.Matrix4,o=s.elements,l=r(e);return o[0]=l.scale[0],o[1]=0,o[2]=l.offset[0]*i,o[3]=0,o[4]=0,o[5]=l.scale[1],o[6]=-l.offset[1]*i,o[7]=0,o[8]=0,o[9]=0,o[10]=a/(n-a)*-i,o[11]=a*n/(n-a),o[12]=0,o[13]=0,o[14]=i,o[15]=0,s.transpose(),s}function i(e,t,n,r){var i=Math.PI/180,s={upTan:Math.tan(e.upDegrees*i),downTan:Math.tan(e.downDegrees*i),leftTan:Math.tan(e.leftDegrees*i),rightTan:Math.tan(e.rightDegrees*i)};return a(s,t,n,r)}var s,o,l,c,d;navigator.getVRDevices&&navigator.getVRDevices().then(n),this.scale=1,this.setSize=function(t,n){e.setSize(t,n)};var u=!1,f=e.domElement,h=f.mozRequestFullScreen?"mozfullscreenchange":"webkitfullscreenchange";document.addEventListener(h,function(e){u=document.mozFullScreenElement||document.webkitFullscreenElement},!1),this.setFullScreen=function(e){void 0!==s&&u!==e&&(f.mozRequestFullScreen?f.mozRequestFullScreen({vrDisplay:s}):f.webkitRequestFullscreen&&f.webkitRequestFullscreen({vrDisplay:s}))};var g=new THREE.PerspectiveCamera,m=new THREE.PerspectiveCamera;this.render=function(t,n){if(s){var r,a;Array.isArray(t)?(r=t[0],a=t[1]):(r=t,a=t);var u=e.getSize();return u.width/=2,e.enableScissorTest(!0),null===n.parent&&n.updateMatrixWorld(),g.projectionMatrix=i(l,!0,n.near,n.far),m.projectionMatrix=i(d,!0,n.near,n.far),n.matrixWorld.decompose(g.position,g.quaternion,g.scale),n.matrixWorld.decompose(m.position,m.quaternion,m.scale),g.translateX(o.x*this.scale),m.translateX(c.x*this.scale),e.setViewport(0,0,u.width,u.height),e.setScissor(0,0,u.width,u.height),e.render(r,g),e.setViewport(u.width,0,u.width,u.height),e.setScissor(u.width,0,u.width,u.height),e.render(a,m),void e.enableScissorTest(!1)}Array.isArray(t)&&(t=t[0]),e.render(t,n)}};